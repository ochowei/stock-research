æ²’å•é¡Œã€‚å°‡ã€Œåƒæ•¸åˆ‡æ›ã€æ”¹ç‚ºã€Œç¨ç«‹è…³æœ¬ã€é€šå¸¸æ›´ç›´è§€ï¼Œä¹Ÿæ–¹ä¾¿æ‚¨åœ¨ä¸åŒçš„çµ‚ç«¯æ©Ÿè¦–çª—åŒæ™‚åŸ·è¡Œå…©çµ„å›æ¸¬ï¼Œäº’ä¸å¹²æ“¾ã€‚

é€™æ˜¯ä¸€å€‹å®Œå…¨åˆ†é›¢é›™è»Œï¼ˆCustom vs. Indexï¼‰çš„ **V5.2 æœ€çµ‚åŸ·è¡Œè¨ˆç•«**ã€‚

æˆ‘å€‘å°‡æ•´å€‹æµç¨‹æ‹†åˆ†ç‚º **Track A (Custom / Asset Pool)** èˆ‡ **Track B (Index / Full Market)**ï¼Œé—œéµæ­¥é©Ÿï¼ˆä¸‹è¼‰ã€å›æ¸¬ï¼‰éƒ½æœƒæœ‰å…©ä»½ç¨ç«‹çš„è…³æœ¬ã€‚

---

# **ğŸ“ˆ å°ˆæ¡ˆ V5.2-Risk åŸ·è¡Œè¨ˆç•«ï¼šé›™è»Œå›æ¸¬é«”ç³» (Two-Track Final)**

**Date:** 2025-12-04
**Based on:** V5.2/research_plan.md
**Status:** #execution-plan #final #dual-track

æœ¬è¨ˆç•«æ—¨åœ¨å¯¦ä½œ V5.2-Risk é«”ç³»ï¼Œä¸¦é€é**é›™è»Œä¸¦è¡Œ**çš„æ–¹å¼ï¼Œé©—è­‰ç­–ç•¥åœ¨ã€Œè‡ªé¸æ¸…å–®ã€èˆ‡ã€Œå…¨å¸‚å ´æŒ‡æ•¸ã€ä¸Šçš„è¡¨ç¾å·®ç•°ã€‚

## **æ­¥é©Ÿ 0ï¼šæ•¸æ“šå·¥ç¨‹ (Data Engineering)**

æˆ‘å€‘å°‡å»ºç«‹å…©å¥—ä¸‹è¼‰è…³æœ¬ï¼Œåˆ†åˆ¥è² è²¬ä¸åŒçš„æ¨™çš„ä¾†æºï¼Œä¸¦å­˜å…¥ä¸åŒçš„è³‡æ–™å¤¾ä»¥é˜²æ··æ·†ã€‚

* **å…±ç”¨è¨­å®šï¼š**
    * å›æ¸¬å€é–“ï¼š`2015-01-01` è‡³ `2025-11-30`ã€‚
    * è³‡æ–™å¤¾çµæ§‹ï¼š`data/custom/` vs `data/index/`ã€‚

* **Track A: è‡ªé¸æ¸…å–®ä¸‹è¼‰ (`00_download_custom.py`)**
    * **ä¾†æºï¼š** è®€å– `ml_pipeline/asset_pool.json`ã€‚
    * **è¼¸å‡ºï¼š** `data/custom/raw_tickers.pkl`, `data/custom/raw_macro.pkl`ã€‚

* **Track B: å…¨å¸‚å ´æ¸…å–®ä¸‹è¼‰ (`00_download_index.py`)**
    * **ä¾†æºï¼š** ä½¿ç”¨ `pd.read_html` çˆ¬å– Wikipedia çš„ **S&P 100** èˆ‡ **Nasdaq 100** æœ€æ–°æˆåˆ†è‚¡ã€‚
    * **è¼¸å‡ºï¼š** `data/index/raw_tickers.pkl`, `data/index/raw_macro.pkl`ã€‚

## **æ­¥é©Ÿ 1~3ï¼šç‰¹å¾µèˆ‡è¨Šè™Ÿè™•ç† (Feature & Signal)**

ç‚ºäº†é¿å…ç¶­è­·éå¤šè…³æœ¬ï¼Œä¸­é–“è™•ç†æ­¥é©Ÿï¼ˆ01, 02, 03ï¼‰å»ºè­°ä¿æŒä¸€ä»½ï¼Œä½†é€é**ä¿®æ”¹é ‚éƒ¨è®Šæ•¸**æˆ–**è‡ªå‹•åµæ¸¬**ä¾†æ±ºå®šè™•ç†å“ªå€‹è³‡æ–™å¤¾ã€‚

* **`01_format_data.py`**: å°‡ `data/custom` èˆ‡ `data/index` å…§çš„ pkl è½‰ç‚º parquetã€‚
* **`02_build_features.py`**:
    * è¨ˆç®— **Market Breadth** (å¸‚å ´å¯¬åº¦)ï¼šS&P 100 æˆåˆ†è‚¡ > SMA200 çš„æ¯”ä¾‹ã€‚
    * *æ³¨æ„ï¼šTrack A (è‡ªé¸) å› ç‚ºæ¨£æœ¬æ•¸å°‘ï¼Œè¨ˆç®—å¯¬åº¦å¯èƒ½å¤±çœŸï¼Œå»ºè­° Track A ç›´æ¥å¼•ç”¨ Track B è¨ˆç®—å‡ºä¾†çš„ Market Breadth ä½œç‚ºå¤–éƒ¨å¤§ç›¤æ¿¾ç¶²ã€‚*
* **`03_build_regime_filter.py`**:
    * ç”¢å‡ºé˜²ç¦¦è¨Šè™Ÿ `regime_signals.parquet` (Breadth < 20% = Crash)ã€‚

## **æ­¥é©Ÿ 4ï¼šé›™è»Œå›æ¸¬èˆ‡åŸºæº–å°æ¯” (Backtesting)**

é€™æ˜¯é©—è­‰çš„æ ¸å¿ƒï¼Œå…©ä»½è…³æœ¬åˆ†åˆ¥è·‘å‡ºçµæœï¼Œæœ€å¾Œé€²è¡Œå°æ¯”ã€‚

* **Track A: è‡ªé¸æ¸…å–®å›æ¸¬ (`05_backtest_custom.py`)**
    * **æ¨™çš„ï¼š** `asset_pool.json`ã€‚
    * **Benchmarkï¼š** è¼‰å…¥ V5.1 çš„ `minimalist_trades.csv` é€²è¡Œ Apple-to-Apple å°æ¯”ã€‚
    * **é¢¨æ§ï¼š** å•Ÿç”¨ `RiskManager` (Vol-Targeting) + `RegimeFilter`ã€‚
    * **è¼¸å‡ºï¼š** `analysis/custom_performance.csv`, `analysis/custom_equity.png`ã€‚

* **Track B: å…¨å¸‚å ´å›æ¸¬ (`05_backtest_index.py`)**
    * **æ¨™çš„ï¼š** S&P 100 + Nasdaq 100 å…¨æˆåˆ†è‚¡ã€‚
    * **Benchmarkï¼š** éœ€é¡å¤–è¨ˆç®—ä¸€å€‹ "Index Buy&Hold" æˆ– "Index Equal Weight" ä½œç‚ºåŸºæº–ã€‚
    * **ç›®çš„ï¼š** å£“åŠ›æ¸¬è©¦ã€‚é©—è­‰ç­–ç•¥æ˜¯å¦åªå°ç‰¹å®šå¦–è‚¡æœ‰æ•ˆï¼Œé‚„æ˜¯å…·æœ‰æ™®é©æ€§ã€‚
    * **è¼¸å‡ºï¼š** `analysis/index_performance.csv`, `analysis/index_equity.png`ã€‚

## **æ­¥é©Ÿ 5ï¼šæœªä¾†å±•æœ› (Future Work / Backlog)**

ä»¥ä¸‹é …ç›®ä¸åŒ…å«åœ¨æœ¬æ¬¡ V5.2 å¯¦ä½œï¼Œä½†ä¿ç•™ç‚ºå¾ŒçºŒç ”ç©¶æ–¹å‘ï¼š

1.  **æ“´å±•æ¨™çš„æ± ï¼š** IWO (Russell 2000), VOO (S&P 500) æˆåˆ†è‚¡ã€‚
2.  **é«˜é »æ•¸æ“š MLï¼š** å¼•å…¥ 5m/15m Kç·šèˆ‡ç›¤å‰ç›¤å¾Œ (ETH) æ•¸æ“šï¼Œé‡å•Ÿ L3/L4 æ¨¡å‹ç ”ç©¶ã€‚
3.  **ML æ¨¡çµ„ä¿®å¾©ï¼š** é‡æ–°è¨“ç·´ L1 HMM (è§£æ±ºæ»¯å¾Œå•é¡Œ) èˆ‡ L3 Ranker (è§£æ±ºéæ“¬åˆ)ã€‚

## **æª”æ¡ˆæ¸…å–® (Files Summary)**

### **V5.2-Risk å°ˆæ¡ˆçµæ§‹**

| é¡åˆ¥ | æª”å | èªªæ˜ |
| :--- | :--- | :--- |
| **Download** | **`00_download_custom.py`** | ä¸‹è¼‰ asset_pool.json æ•¸æ“š |
| | **`00_download_index.py`** | ä¸‹è¼‰ S&P/Nasdaq 100 æ•¸æ“š |
| **Process** | `01_format_data.py` | æ ¼å¼åŒ–æ•¸æ“š (é€šç”¨) |
| | `02_build_features.py` | è¨ˆç®—ç‰¹å¾µèˆ‡å¸‚å ´å¯¬åº¦ (é€šç”¨) |
| **Filter** | `03_build_regime_filter.py` | ç”¢ç”Ÿè¦å‰‡å°å‘çš„ L1 è¨Šè™Ÿ |
| **Module** | **`risk_manager.py`** | ç¨ç«‹é¢¨æ§æ¨¡çµ„ (Class) |
| **Backtest** | **`05_backtest_custom.py`** | å›æ¸¬è‡ªé¸æ¸…å–® (å« V5.1 å°æ¯”) |
| | **`05_backtest_index.py`** | å›æ¸¬å…¨å¸‚å ´æ¸…å–® (å£“åŠ›æ¸¬è©¦) |
| **Production** | `run_daily_inference.py` | å¯¦ç›¤æ¯æ—¥æ¨è«–è…³æœ¬ |
| **Config** | `asset_pool.json` | è‡ªé¸è‚¡æ¸…å–® |
| | `requirements.txt` | å¥—ä»¶æ¸…å–® |

é€™æ¨£è¦åŠƒå¾Œï¼Œæ‚¨å¯ä»¥æ¸…æ¥šåœ°å¾—åˆ°å…©ä»½ç¨ç«‹çš„å ±å‘Šï¼Œä¸€ä»½å‘Šè¨´æ‚¨ã€Œç­–ç•¥åœ¨æ‚¨çš„æ„›è‚¡ä¸Šè¡¨ç¾å¦‚ä½• (vs V5.1)ã€ï¼Œå¦ä¸€ä»½å‘Šè¨´æ‚¨ã€Œç­–ç•¥åœ¨çµ±è¨ˆå­¸ä¸Šçš„çœŸå¯¦ç©©å¥åº¦ã€ã€‚