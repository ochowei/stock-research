### **ğŸ“ˆ å°ˆæ¡ˆ V4-D.8 (v7.0) åŸ·è¡Œè¨ˆç•« (ä¿®è¨‚ç‰ˆ - å¿½ç•¥è²¡å ±éæ¿¾)**

#### **æ­¥é©Ÿ 0ï¼šå°ˆæ¡ˆåˆå§‹åŒ– (Setup)**

æ­¤æ­¥é©Ÿè² è²¬å»ºç«‹å°ˆæ¡ˆç’°å¢ƒä¸¦ç²å–æœ€æ–°çš„è³‡ç”¢æ± ã€‚

* **ç›®æ¨™ï¼š** å¾ Gist ç²å–æ¨™çš„åˆ—è¡¨ï¼Œç‚ºæ•¸æ“šä¸‹è¼‰åšæº–å‚™ã€‚  
* **åŸ·è¡Œï¼š**  
  1. æ’°å¯«ä¸€å€‹è…³æœ¬ (e.g., 00\_setup.py)ã€‚  
  2. å¾ Gist URL (https://gist.github.com/ochowei/9b24d188882ab92e2cc5a336e9675f17) ä¸‹è¼‰è³‡ç”¢åˆ—è¡¨ã€‚  
  3. è§£æåˆ—è¡¨ï¼ˆçœ‹èµ·ä¾†åƒ JSON æ ¼å¼ï¼‰ä¸¦å°‡å…¶ä¿å­˜ç‚ºæœ¬åœ°çš„è³‡ç”¢æ± æ–‡ä»¶ï¼Œä¾›å¾ŒçºŒæ­¥é©Ÿä½¿ç”¨ã€‚  
* **ç”¢å‡ºæª”æ¡ˆï¼š**  
  * asset\_pool.json: æœ¬åœ°ä¿å­˜çš„æ¨™çš„åˆ—è¡¨ã€‚

---

#### **æ­¥é©Ÿ 1ï¼šåŸå§‹æ•¸æ“šç²å– (Data Acquisition)**

æ ¹æ“š v7.0 è¦æ ¼ï¼Œæˆ‘å€‘éœ€è¦ 60m æ•¸æ“šï¼ˆç‰¹å¾µï¼‰å’Œ Daily æ•¸æ“šï¼ˆæ¨™ç±¤èˆ‡éƒ¨åˆ†ç‰¹å¾µï¼‰ã€‚

* **ç›®æ¨™ï¼š** ä¸‹è¼‰ asset\_pool.json ä¸­æ‰€æœ‰è³‡ç”¢çš„ yfinance åŸå§‹æ•¸æ“šã€‚  
* **åŸ·è¡Œï¼š**  
  1. è®€å– asset\_pool.jsonã€‚  
  2. **60m æ•¸æ“šï¼š** éæ­·æ‰€æœ‰æ¨™çš„ï¼Œä½¿ç”¨ yfinance ä¸‹è¼‰ 60m é »ç‡çš„ K ç·šæ•¸æ“šï¼ˆåŒ…å« RTH å’Œ ETHï¼‰ã€‚
  3. **Daily æ•¸æ“šï¼š** éæ­·æ‰€æœ‰æ¨™çš„ï¼Œä¸‹è¼‰ 1d é »ç‡çš„ K ç·šæ•¸æ“šï¼Œç”¨æ–¼è¨ˆç®— G çµ„ä¸Šä¸‹æ–‡ç‰¹å¾µ 3å’Œ Y æ¨™ç±¤çš„ vol å–®ä½ (T-1 ATR) ã€‚

* **ç”¢å‡ºæª”æ¡ˆï¼š**  
  * raw\_60m.parquet: åŒ…å«æ‰€æœ‰è³‡ç”¢ 60 åˆ†é˜ K ç·šçš„ Panel Dataã€‚
    * ç´¢å¼• (Index): ['symbol', 'timestamp']
    * æ¬„ä½ (Columns):    
      * Open (ç”¨æ–¼è¨ˆç®— K æ£’å½¢ç‹€)    
      * High (ç”¨æ–¼è¨ˆç®— ATR, MFI)    
      * Low (ç”¨æ–¼è¨ˆç®— ATR, MFI, T æ—¥é€²å ´åˆ¤æ–·)    
      * Close (ç”¨æ–¼è¨ˆç®— RSI, Z-Score)    
      * Volume (ç”¨æ–¼è¨ˆç®— MFI, Vol_Ratio)
  * raw\_daily.parquet: åŒ…å«æ‰€æœ‰è³‡ç”¢æ—¥ K ç·šçš„ Panel Dataã€‚
    * ç´¢å¼• (Index): ['symbol', 'timestamp']
    * æ¬„ä½ (Columns):   
      * Open (ç”¨æ–¼ T+1 é–‹ç›¤åƒ¹å‡ºå ´ p_exit)
      * High (ç”¨æ–¼ T-1 Daily ATR)
      * Low (ç”¨æ–¼ T-1 Daily ATR)
      * Close (ç”¨æ–¼ T-1 æ”¶ç›¤åƒ¹é€²å ´ p, T-1 Daily ATR)
      * Volume (ç”¨æ–¼ G çµ„ Amihud æµå‹•æ€§)
      * Adj Close (G çµ„ Momentum/Z-Score è¨ˆç®—ç”¨)
  * ~earnings_dates.parquet: (æ ¹æ“šæ‚¨çš„æ±ºå®šï¼Œæ­¤æª”æ¡ˆä¸å†éœ€è¦)~ã€‚

---

#### **æ­¥é©Ÿ 2ï¼šç‰¹å¾µå·¥ç¨‹ (Feature Engineering \- X)**

æ­¤ç‚º v7.0 çš„æ ¸å¿ƒã€‚æˆ‘å€‘å°‡å»ºç«‹è¦æ ¼æ›¸ 2.1.1 ç¯€ä¸­å®šç¾©çš„ 67 å€‹ç‰¹å¾µ ã€‚

* **ç›®æ¨™ï¼š** æ ¹æ“š T-1 æ—¥æ”¶ç›¤å¾Œçš„å¯ç”¨è³‡è¨Š ï¼Œè¨ˆç®— 67 å€‹ç‰¹å¾µ (X)ã€‚

* **åŸ·è¡Œï¼š**  
  1. è¼‰å…¥ raw\_60m.parquet å’Œ raw\_daily.parquetã€‚  
  2. **Base Metrics:** å»ºç«‹ 9 å€‹åŸºç¤æŒ‡æ¨™ (RSI, ATR, MFI, Vol\_Ratio ç­‰) çš„è¨ˆç®—å‡½æ•¸ã€‚

  3. **æ–¹æ¡ˆ C (Full/Partial)ï¼š**  
     * åš´æ ¼å€åˆ† RTH vs ETHã€‚

     * åš´æ ¼åˆ†é›¢ \_Full (å®Œæ•´ 60m K æ£’) å’Œ \_Partial (ä¸å®Œæ•´ K æ£’) ã€‚

  4. **A/B/C çµ„ (63 ç‰¹å¾µ)ï¼š**  
     * è¨ˆç®— A çµ„ï¼šRTH å®Œæ•´ K æ£’åŒ¯ç¸½ (9 metrics \* 3 agg) \= 27 ç‰¹å¾µ ã€‚

     * è¨ˆç®— B çµ„ï¼šETH å®Œæ•´ K æ£’åŒ¯ç¸½ (9 metrics \* 3 agg) \= 27 ç‰¹å¾µ ã€‚

     * è¨ˆç®— C çµ„ï¼šETH ä¸å®Œæ•´ K æ£’ (9 metrics \* 1 agg) \= 9 ç‰¹å¾µ ã€‚

  5. **G çµ„ (4 ç‰¹å¾µ)ï¼š**  
     * ä½¿ç”¨ raw\_daily.parquet è¨ˆç®— X\_34 (Beta), X\_35 (Momentum), X\_36 (Z-Score), X\_37 (Amihud) ã€‚

  6. å°‡æ‰€æœ‰ 67 å€‹ç‰¹å¾µåˆä½µç‚ºä¸€å€‹ä»¥ (asset, T-1 timestamp) ç‚ºç´¢å¼•çš„ç‰¹å¾µçŸ©é™£ã€‚  
* **ç”¢å‡ºæª”æ¡ˆï¼š**  
  * features\_X\_T-1.parquet: åŒ…å« 67 å€‹ç‰¹å¾µçš„æœ€çµ‚ç‰¹å¾µé›†ã€‚

---

#### **æ­¥é©Ÿ 3ï¼šæ¨™ç±¤å·¥ç¨‹ (Label Engineering \- Y)**

æ­¤æ­¥é©Ÿå»ºç«‹ v7.0 çš„ã€Œå‹•æ…‹é¢¨éšªæ¨™æº–åŒ–å›å ±ã€å›æ­¸æ¨™ç±¤ ã€‚

* **ç›®æ¨™ï¼š** è¨ˆç®— Y æ¨™ç±¤ï¼ˆå›æ­¸å€¼ï¼‰ã€‚  
* **åŸ·è¡Œï¼š**  
  1. è¼‰å…¥ raw\_60m.parquet å’Œ raw\_daily.parquetã€‚  
  2. **è¨ˆç®—è¼¸å…¥åƒæ•¸ (T-1 æ—¥)ï¼š**  
     * p (é€²å ´åƒ¹æ ¼) \= T-1 Close ã€‚

     * vol (æ³¢å‹•ç‡å–®ä½) \= T-1 æ—¥çš„ 14 å¤© ATR (ä¾†è‡ª Daily æ•¸æ“š) ã€‚

  3. **è¨ˆç®—çµç®—åƒ¹æ ¼ (T+1 æ—¥)ï¼š**  
     * p\_exit (çµç®—åƒ¹æ ¼) \= T+1 æ—¥çš„é–‹ç›¤åƒ¹ã€‚

  4. **æƒ…å¢ƒåˆ¤æ–·ï¼š**  
     * **æƒ…å¢ƒ B (æœªæˆäº¤)ï¼š** æª¢æŸ¥ T æ—¥çš„ 60m Low æ˜¯å¦æ›¾è§¸åŠ pã€‚è‹¥ç„¡ï¼Œæ¨™è¨˜ç‚º NO\_FILLã€‚

     * **æƒ…å¢ƒ A (æˆäº¤)ï¼š** è‹¥ T æ—¥ 60m Low è§¸åŠ pï¼Œå‰‡è¨ˆç®—æ¨™ç±¤ã€‚

  5. **Y æ¨™ç±¤è¨ˆç®— (æƒ…å¢ƒ A)ï¼š**  
     * Y \= (p\_exit \- p) / volã€‚

  6. **Y æ¨™ç±¤è™•ç† (æƒ…å¢ƒ B)ï¼š**  
     * Y \= 0 (æˆ– Null)ã€‚

* **ç”¢å‡ºæª”æ¡ˆï¼š**  
  * labels\_Y.parquet: åŒ…å« (asset, T-1 timestamp) ç´¢å¼•åŠå°æ‡‰çš„ Y å€¼å’Œ Fill\_Status (e.g., 'FILLED', 'NO\_FILL')ã€‚

---

#### **æ­¥é©Ÿ 4ï¼šæ•¸æ“šæ¸…ç†èˆ‡åˆä½µ (Data Cleaning & Merging)**

æ ¹æ“š 3.1 ç¯€çš„è¦å‰‡ï¼Œå»ºç«‹æœ€çµ‚çš„å»ºæ¨¡æ•¸æ“šé›†ã€‚

* **ç›®æ¨™ï¼š** åˆä½µ X å’Œ Yï¼Œä¸¦æ‡‰ç”¨åš´æ ¼çš„æ¸…ç†è¦å‰‡ã€‚  
* **åŸ·è¡Œï¼š**  
  1. è¼‰å…¥ features\_X\_T-1.parquet å’Œ labels\_Y.parquetã€‚  
  2. è¼‰å…¥ earnings\_dates.parquetã€‚  
  3. **åˆä½µï¼š** å°‡ X å’Œ Y çŸ©é™£å°é½Š (asset, timestamp)ã€‚  
  4. ~**è¦å‰‡ä¸€ (è²¡å ±)ï¼š** åˆªé™¤ T æ—¥æˆ– T+1 æ—¥å€é–“å…§æœ‰è²¡å ±çš„æ¨£æœ¬ã€‚~

  5. **è¦å‰‡äºŒ (æœªæˆäº¤)ï¼š** åš´æ ¼åˆªé™¤æ‰€æœ‰ Fill\_Status ç‚º NO\_FILL (å³ Y=0 æˆ– Null) çš„æ¨£æœ¬ã€‚

* **ç”¢å‡ºæª”æ¡ˆï¼š**  
  * model\_ready\_dataset.parquet: æœ€çµ‚ã€ä¹¾æ·¨çš„ã€å¯ç”¨æ–¼è¨“ç·´çš„é¢æ¿æ•¸æ“šã€‚

---

#### **æ­¥é©Ÿ 5ï¼šæ¨¡å‹è¨“ç·´èˆ‡ä¸ç¢ºå®šæ€§æ¯”è¼ƒ (Uncertainty Bake-off)**

æ­¤æ­¥é©Ÿæ“´å±•äº†åŸæœ‰çš„æ¨¡å‹è¨“ç·´ï¼Œæ—¨åœ¨æ¯”è¼ƒä¸‰ç¨®ä¸åŒçš„ä¸ç¢ºå®šæ€§æ•æ‰æ–¹æ¡ˆã€‚

* **ç›®æ¨™ï¼š** åœ¨æ»¾å‹•é©—è­‰æ¡†æ¶ä¸‹ï¼Œä¸¦è¡Œè¨“ç·´ä¸‰ç¨®æ¨¡å‹ï¼Œä¸¦ç”¢å‡ºåŒ…å«æ‰€æœ‰é æ¸¬çš„å–®ä¸€çµæœæª”æ¡ˆã€‚
* **ä¾è³´æ›´æ–°ï¼š** æ­¤æ­¥é©Ÿçš„å¯¦ä½œå°‡éœ€è¦æ›´æ–° `data_acquisition/requirements.txt`ï¼ŒåŠ å…¥ `scikit-learn` å’Œ `lightgbm`ã€‚
* **åŸ·è¡Œï¼š**
  1. è¼‰å…¥ `model_ready_dataset.parquet`ã€‚
  2. **å®šç¾©æ»¾å‹•çª—å£ (k)ï¼š**
     * è¨­å®š `Train_k` å’Œ `Test_k` çš„æ™‚é–“ç¯„åœã€‚
  3. **åœ¨çª—å£ k ä¸­å¾ªç’°ï¼š**
     * **æ•¸æ“šæ¨™æº–åŒ– (Standardization)ï¼š**
       * `scaler_k = StandardScaler()`
       * `scaler_k.fit(Train_k[X_features])` (åƒ…åœ¨ `Train_k` ä¸Šæ“¬åˆ)
       * `X_train_scaled = scaler_k.transform(Train_k[X_features])`
       * `X_test_scaled = scaler_k.transform(Test_k[X_features])`
     * **æ¨¡å‹è¨“ç·´èˆ‡é æ¸¬ (Bake-off)ï¼š** åœ¨**åŒä¸€å€‹**æ»¾å‹•çª—å£ `k` ä¸­ï¼Œä¸¦è¡Œè¨“ç·´ä»¥ä¸‹ä¸‰å€‹æ¨¡å‹ç³»åˆ—ï¼š
       * **æ–¹æ¡ˆ A (å…©éšæ®µæ¨¡å‹)ï¼š**
         1.  è¨“ç·´ `model_A_Y = Ridge()` ä¾†é æ¸¬ `Y` (å¾—åˆ° `Y_pred_A`)ã€‚
         2.  è¨ˆç®—èª¤å·® `Y_error = |Y_true - Y_pred_A|`ã€‚
         3.  è¨“ç·´ `model_A_Uncertainty = Ridge()` ä¾†é æ¸¬ `Y_error` (å¾—åˆ° `Y_uncertainty_A`)ã€‚
       * **æ–¹æ¡ˆ B (åˆ†ä½æ•¸å›æ­¸)ï¼š**
         1.  ä½¿ç”¨ `LGBMRegressor(objective='quantile', ...)` æˆ– `sklearn.linear_model.QuantileRegressor`ã€‚
         2.  è¨“ç·´ `model_B_Lower` (é æ¸¬ Q0.1)ã€‚
         3.  è¨“ç·´ `model_B_Median` (é æ¸¬ Q0.5ï¼Œä½œç‚ºé»é æ¸¬)ã€‚
         4.  è¨“ç·´ `model_B_Upper` (é æ¸¬ Q0.9)ã€‚
       * **æ–¹æ¡ˆ C (è²æ°å›æ­¸)ï¼š**
         1.  è¨“ç·´ `model_C_Bayesian = BayesianRidge()`ã€‚
         2.  ä½¿ç”¨ `model_C_Bayesian.predict(..., return_std=True)` é€²è¡Œé æ¸¬ï¼Œå¾—åˆ° `Y_pred_C` å’Œ `Y_std_C`ã€‚
     * **å„²å­˜çµæœï¼š** å„²å­˜ `predictions_k`ï¼Œå…¶ä¸­åŒ…å« `Test_k` çš„çœŸå¯¦ Y å€¼ä»¥åŠä¾†è‡ª A, B, C ä¸‰å€‹æ–¹æ¡ˆçš„æ‰€æœ‰é æ¸¬çµæœã€‚
  4. **æ»¾å‹• (Roll Forward)ï¼š** ç§»å‹•çª—å£ï¼Œé‡è¤‡æ­¥é©Ÿ 3ã€‚

* **ç”¢å‡ºæª”æ¡ˆï¼š**
  * `predictions_oos.csv`: ä¸€å€‹åˆä½µæ‰€æœ‰ `predictions_k` çš„å¸¶å¤– (Out-of-Sample) é æ¸¬çµæœæª”æ¡ˆã€‚æ¬„ä½æ‡‰åŒ…å«ï¼š
    * `Y_true`
    * `Y_pred_A`, `Y_uncertainty_A`
    * `Y_pred_B_Lower`, `Y_pred_B_Median`, `Y_pred_B_Upper`
    * `Y_pred_C`, `Y_std_C`
  * `models/`: æ­¤ç›®éŒ„å°‡åŒ…å«æ¯å€‹æ»¾å‹•çª—å£ `k` è¨“ç·´å‡ºçš„æ‰€æœ‰æ¨¡å‹æª”æ¡ˆ (ä¾‹å¦‚ `model_A_Y_fold_{k}.joblib`, `model_B_Lower_fold_{k}.joblib` ç­‰)ã€‚

---

#### **æ­¥é©Ÿ 6ï¼šå›æ¸¬åˆ†æèˆ‡æ¨¡å‹æ¯”è¼ƒ**

* **ç›®æ¨™ï¼š** åˆ†æ `predictions_oos.csv` çš„é æ¸¬è¡¨ç¾ï¼Œä¸¦æ¯”è¼ƒä¸‰ç¨®ä¸ç¢ºå®šæ€§æ–¹æ¡ˆçš„å„ªåŠ£ã€‚
* **åŸ·è¡Œï¼š**
  1. è¼‰å…¥ `predictions_oos.csv`ã€‚
  2. **æ¯”è¼ƒ (1) - é æ¸¬æº–ç¢ºæ€§ (Point Prediction Accuracy)ï¼š**
     * æ¯”è¼ƒ `Y_pred_A`, `Y_pred_B_Median`, `Y_pred_C` ä¸‰å€‹é»é æ¸¬å“ªå€‹æœ€æº–ç¢ºã€‚
     * ä½¿ç”¨æŒ‡æ¨™ï¼šRMSE, MAE, Spearman ç›¸é—œæ€§ã€‚
  3. **æ¯”è¼ƒ (2) - ä¸ç¢ºå®šæ€§æ ¡æº– (Uncertainty Calibration)ï¼š**
     * åˆ†æå“ªå€‹ä¸ç¢ºå®šæ€§æŒ‡æ¨™èˆ‡ã€Œå¯¦éš›é æ¸¬èª¤å·®ã€(`|Y_true - Y_pred|`) çš„ç›¸é—œæ€§æœ€é«˜ã€‚
     * æª¢é©—çš„é…å°ï¼š
       * `Y_uncertainty_A` vs. `|Y_true - Y_pred_A|`
       * å€é–“å¯¬åº¦ (`Y_pred_B_Upper - Y_pred_B_Lower`) vs. `|Y_true - Y_pred_B_Median|`
       * `Y_std_C` vs. `|Y_true - Y_pred_C|`
  4. **æ¨¡æ“¬äº¤æ˜“ (åŸºæ–¼æœ€ä½³æ¨¡å‹)ï¼š**
     * é¸æ“‡åœ¨æ¯”è¼ƒ (1) å’Œ (2) ä¸­ç¶œåˆè¡¨ç¾æœ€å¥½çš„æ¨¡å‹ã€‚
     * æ ¹æ“šå…¶é æ¸¬å€¼å’Œä¸ç¢ºå®šæ€§è¨­è¨ˆäº¤æ˜“ç­–ç•¥ï¼ˆä¾‹å¦‚ï¼Œåƒ…åœ¨ä¸ç¢ºå®šæ€§è¼ƒä½æ™‚é€²è¡Œäº¤æ˜“ï¼‰ã€‚
     * è¨ˆç®—æŠ•è³‡çµ„åˆçš„å¤æ™®æ¯”ç‡ (Sharpe Ratio)ã€ç´¯ç©å›å ±ç­‰ç¸¾æ•ˆæŒ‡æ¨™ã€‚
* **ç”¢å‡ºæª”æ¡ˆï¼š**
  * `backtest_report.ipynb` (æˆ– .html): åŒ…å«æ‰€æœ‰æ¯”è¼ƒåˆ†æã€ç¸¾æ•ˆåœ–è¡¨å’Œæœ€çµ‚æ¨¡å‹é¸æ“‡çµè«–çš„å ±å‘Šã€‚
