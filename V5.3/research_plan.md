# ç ”ç©¶è¨ˆç•«ï¼šV5.3-Dynamic (Track A) æ•¸æ“šæª¢æ ¸èˆ‡å‹•æ…‹æ”»é˜²ç³»çµ± (Final Revised v7.1)

**Date:** 2025-12-04 (Updated: Added Dataset Definitions)
**Focus:** ğŸŸ¢ **Free Data Only (yfinance)**
**Constraint:** ğŸ‡¹ğŸ‡¼ **Taiwan Timezone (T-1 Decision / T Open Execution)**
**Goal:** åœ¨å…è²»æ•¸æ“šèˆ‡å¯¦ç›¤é™åˆ¶ä¸‹ï¼Œé©—è­‰å‹•æ…‹é¢¨æ§çš„æœ‰æ•ˆæ€§ï¼Œä¸¦ç‚º V5.4 çš„å…¨çœŸå›æ¸¬å¥ å®šåŸºç¤ã€‚

---

## **éšæ®µä¸€ï¼šæ•¸æ“šå¯©è¨ˆèˆ‡åŸºæº–é‡ç¾ (Data Audit & Baselining)**

**ç›®æ¨™ï¼š** åœ¨é–‹ç™¼æ–°åŠŸèƒ½å‰ï¼Œå…ˆç¢ºä¿æ•¸æ“šå“è³ªï¼Œä¸¦å»ºç«‹æ¸…æ´—å¾Œçš„æ¨™æº–æ¸¬è©¦é›†ï¼Œé‡åŒ–ã€Œç¯©é¸åå·®ã€çš„å½±éŸ¿ã€‚

### **1.1 å·¥ä½œé …ç›®ï¼šæ•¸æ“šè¦†è“‹ç‡åˆ†æèˆ‡æ¸…æ´— (Data Sufficiency Analysis & Cleaning)**
* **å•é¡Œï¼š** ç¹¼æ‰¿è‡ª V5.2 çš„æ¸…å–®æ˜¯éœæ…‹çš„ï¼Œå¯èƒ½åŒ…å«åœ¨æ—©æœŸå¹´ä»½ï¼ˆå¦‚ 2015-2018ï¼‰å°šæœªä¸Šå¸‚æˆ–æµå‹•æ€§ä¸è¶³çš„æ¨™çš„ã€‚
* **åŸ·è¡Œå‹•ä½œ (æ’°å¯« `00_audit_data.py`):**
    1.  **è®€å–èˆ‡å¯©è¨ˆï¼š** è®€å– `Standard`( asset_pool.json, toxic_asset_pool.json) æ¸…å–®ï¼Œæª¢æŸ¥æ¯æª”æ¨™çš„åœ¨ 2015-2025 é–“çš„ã€Œæœ‰æ•ˆäº¤æ˜“æ—¥ã€èˆ‡ã€Œæµå‹•æ€§ã€ã€‚
    2.  **ç”Ÿæˆæ¸…æ´—æ¸…å–®ï¼š** å°‡ç¬¦åˆæ¨™æº–çš„æ¨™çš„å¯«å…¥ `Final` æ¸…å–®ã€‚
    3.  **ç”¢å‡ºå ±å‘Šï¼š** ç”Ÿæˆ `data_selection_report.md` èˆ‡ `data_coverage_over_time.png`ã€‚

### **1.2 å·¥ä½œé …ç›®ï¼šåŸºæº–ç·šé‡ç¾ (Benchmark Re-implementation)**
* **ç›®æ¨™ï¼š** ä½¿ç”¨ä¸‰çµ„ä¸åŒå“è³ªçš„æ¸…å–®è·‘åˆ†ï¼Œé‡åŒ–ã€Œå€–å­˜è€…åå·®ã€èˆ‡ã€Œæ•¸æ“šæ¸…æ´—ã€å°ç¸¾æ•ˆçš„å½±éŸ¿ï¼Œä¸¦ä½¿ç”¨ **æ¸…æ´—å¾Œçš„æ–°ç‰ˆæ¸…å–®** è·‘å‡º V5.1ã€V5.2 èˆ‡å¤§ç›¤çš„æˆç¸¾å–®ä½œç‚ºå°ç…§ã€‚ã€‚
* **åŸ·è¡Œå‹•ä½œ (æ’°å¯« `05_backtest_benchmarks.py`):**
    * å°ä¸‰çµ„è³‡æ–™é›†åˆ†åˆ¥åŸ·è¡Œ V5.1 èˆ‡ V5.2 å›æ¸¬ã€‚

### **1.3 [NEW] è³‡æ–™é›†å®šç¾© (Dataset Definitions)**
ç‚ºäº†ç²¾ç¢ºè©•ä¼°æ•¸æ“šå“è³ªå°ç­–ç•¥çš„å½±éŸ¿ï¼Œæœ¬è¨ˆç•«å®šç¾©ä¸‰å±¤ç´šçš„è³‡ç”¢æ± ï¼š

| è³‡æ–™é›† (Dataset) | æª”æ¡ˆå‰ç¶´ (Prefix) | æª”æ¡ˆåç¨± (Files) | å®šç¾©èˆ‡ç”¨é€” (Definition & Usage) |
| :--- | :--- | :--- | :--- |
| **Origin (åŸå§‹çµ„)** | `origin` | `origin_asset_pool.json`<br>`origin_toxic_asset_pool.json` | **æ­·å²éºè·¡**ã€‚ç¹¼æ‰¿è‡ª V5.2 æˆ–æ›´æ—©æœŸçš„åŸå§‹æ¸…å–®ï¼Œå®Œå…¨æœªç¶“ V5.3 æ¨™æº–å¯©è¨ˆã€‚ç”¨æ–¼å‘ˆç¾ã€Œæœ€åŸå§‹ã€æœªç¶“ä¿®é£¾ã€çš„åŸºç·šã€‚ |
| **Standard (æ¨™æº–çµ„)** | `standard` | `asset_pool.json`<br>`toxic_asset_pool.json` | **ç•¶å‰è¼¸å…¥**ã€‚ä½œç‚º `00_audit_data.py` çš„ä¸»è¦è¼¸å…¥ä¾†æº (Input)ã€‚ä»£è¡¨å°šæœªé€²è¡Œæœ¬æ¬¡åš´æ ¼æ¸…æ´—å‰çš„ç‹€æ…‹ã€‚ |
| **Final (æ¸…æ´—çµ„)** | `final` | `final_asset_pool.json`<br>`final_toxic_asset_pool.json` | **æœ€çµ‚è¼¸å‡º**ã€‚é€šé `00_audit_data.py` åš´æ ¼å¯©è¨ˆ (è¦†è“‹ç‡ > 200å¤©/å¹´, éé›¶æˆäº¤) å¾Œçš„é»ƒé‡‘æ¸…å–®ã€‚**V5.3 çš„æ ¸å¿ƒé–‹ç™¼èˆ‡é©—è­‰å°‡ä»¥æ­¤çµ„ç‚ºæº–ã€‚** |


    * **Benchmark A (V5.1 Aggressive):** é‚è¼¯: `Fixed 5-Day` + `No Filter` + `Equal Weight`ã€‚
    * **Benchmark B (V5.2 Risk-Aware):** é‚è¼¯: `Fixed 5-Day` + `Breadth Filter` + `ATR Sizing` (å³ V5.2 Full System)ã€‚
    * **Benchmark C (Market Baseline):** é‚è¼¯: **Buy & Hold (SPY)**ã€‚ä½œç‚ºè©•ä¼°ç­–ç•¥æ˜¯å¦å…·å‚™çœŸå¯¦ Alpha çš„çµ•å°åŸºæº–ã€‚
    * **ç”¢å‡º:** `analysis/baseline_performance.csv`ã€‚
    
---

## **éšæ®µäºŒï¼šæ ¸å¿ƒç³»çµ±å¯¦ä½œ (Core Implementation \- Expanded)**

æ­¤éšæ®µå°‡åŒæ­¥é€²è¡Œã€Œäº¤æ˜“æ©Ÿåˆ¶ã€èˆ‡ã€Œç‰¹å¾µå·¥ç¨‹ã€çš„å‡ç´šã€‚
*(æ­¤éšæ®µæ‰€æœ‰æ•¸æ“šçš†ä¾†è‡ª yfinance OHLCVï¼Œç„¡éœ€ä»˜è²»)*


### **2.0 å¯¦ç›¤æ“ä½œé™åˆ¶ (Operational Constraints)**
* **æƒ…å¢ƒ:** æ“ä½œè€…ä½æ–¼å°ç£ï¼Œç„¡æ³•åœ¨ç¾è‚¡ç›¤ä¸­ç›¯ç›¤ã€‚
* **æµç¨‹:**
    1.  **T-1 æ”¶ç›¤å¾Œ:** ä¸‹è¼‰æ•¸æ“šï¼Œè¨ˆç®—è¨Šè™Ÿã€‚
    2.  **T æ—¥é–‹ç›¤å‰:** é æ›è¨‚å–®ã€‚
* **äº¤æ˜“åŸ·è¡Œ (Execution):**
    * **é€²å ´:** T æ—¥é–‹ç›¤å¸‚åƒ¹å–® (Market on Open)ã€‚
    * **å‡ºå ´:** T æ—¥é–‹ç›¤å‰æ›å‡º **åœæå¸‚åƒ¹å–® (Stop Market Order)**ï¼Œè§¸ç™¼åƒ¹åŸºæ–¼ T-1 æ•¸æ“šå›ºå®šï¼ˆç›¤ä¸­ä¸ç§»å‹•ï¼‰ã€‚

### **2.1 æ•¸æ“šæºæ“´å…… (Data Expansion)**

* **ä¿®æ”¹ 00\_download\_custom.pyï¼š**  
  * æ–°å¢ **L1 æ›¿ä»£æ€§å®è§€æ¨™çš„** ä¸‹è¼‰ï¼š  
    * **HYG** (iShares iBoxx $ High Yield Corp Bond ETF)  
    * **IEF** (iShares 7-10 Year Treasury Bond ETF)  
  * *è¨»ï¼šSPY èˆ‡ VIX åŸæœ¬å·²æœ‰ã€‚*

### **2.2 ç‰¹å¾µå·¥ç¨‹å‡ç´š (Feature Engineering)**

* **ä¿®æ”¹ 02\_build\_features.pyï¼š**  
  * **L1 å®è§€ç‰¹å¾µ (Macro Proxies):**  
    * Junk\_Bond\_Stress: HYG / IEF (æ¯”å€¼ä¸‹é™ \= ä¿¡ç”¨é¢¨éšªå‡é«˜)ã€‚  
    * Risk\_Off\_Flow: IEF / SPY (æ¯”å€¼ä¸Šå‡ \= è³‡é‡‘é¿éšª)ã€‚  
  * **L3 å¾®çµæ§‹ç‰¹å¾µ (Microstructure):**  
    * Amihud\_Illiquidity: abs(Ret) / (Price \* Vol) (æ•¸å€¼å¤§ \= æµå‹•æ€§å·®/è™›èƒ–)ã€‚  
    * Down\_Vol\_Prop: éå» 10 æ—¥ã€Œä¸‹è·Œé‡èƒ½ã€ä½”ã€Œç¸½é‡èƒ½ã€çš„æ¯”ä¾‹ (æ•¸å€¼å¤§ \= ææ…Œæ‹‹å”®)ã€‚

### **2.3 L1 é˜²ç¦¦å±¤ï¼šæ··åˆå¼å´©ç›¤é è­¦ (Hybrid Defense)**

* **é‚è¼¯å‡ç´šï¼š** ä¸åªçœ‹å¸‚å ´å¯¬åº¦ (Breadth)ï¼ŒåŠ å…¥å®è§€å› å­ç¢ºèªã€‚  
* **è¦å‰‡ï¼š**  
  * **Condition A (å…§éƒ¨):** Market Breadth \< 15%ã€‚  
  * **Condition B (å¤–éƒ¨):** Junk\_Bond\_Stress ä½æ–¼ 20æ—¥å‡ç·š **ä¸”** Risk\_Off\_Flow é«˜æ–¼ 20æ—¥å‡ç·š (å³å‚µåˆ¸å¸‚å ´ä¹Ÿç™¼å‡ºè­¦è¨Š)ã€‚  
  * **Action:** è‹¥ A æˆ– B æˆç«‹ï¼Œè§¸ç™¼ **ç†”æ–· (Liquidation)**ã€‚

### **2.4 L3 æ’åºå±¤ï¼šå¾®çµæ§‹å¢å¼·æ’åº (Microstructure Ranking)**

* **é‚è¼¯å‡ç´šï¼š** ä¸å†åªçœ‹ RSI èª°æœ€ä½ï¼Œè€Œæ˜¯çœ‹èª°ã€Œè·Œå¾—æœ€å¥åº·ã€ã€‚  
* **æ’åºåˆ†æ•¸ (Score):**  
  * åŸºç¤åˆ†ï¼šRSI (è¶Šä½åˆ†è¶Šé«˜)ã€‚  
  * æ‡²ç½°é …ï¼šè‹¥ Amihud éé«˜ (æµå‹•æ€§æ¯ç«­) æˆ– Down\_Vol\_Prop éé«˜ (ä¸»åŠ›å‡ºè²¨)ï¼Œæ‰£åˆ†ã€‚  
* **Action:** æ¯æ—¥é¸å– Score æœ€é«˜çš„ Top 5 é€²è¡Œäº¤æ˜“ã€‚

### **2.5 L4 å‡ºå ´å±¤ï¼šå‹•æ…‹è¿½è¹¤æ­¢ç›ˆ (Dynamic Trailing Stop)**

* **æ©Ÿåˆ¶:** éš”æ—¥æ›´æ–°çš„ç§»å‹•æ­¢æã€‚  
* **å…¬å¼:**
$$Stop\_Price_T = Highest\_High_{(Entry \to T-1)} - (K \times ATR_{T-1})$$
* **å‹•æ…‹ K:** é è¨­ $K=3.0$ï¼›è‹¥ L1 å®è§€æŒ‡æ¨™è½‰å·®ï¼Œç¸®ç·Šè‡³ $K=1.5$ã€‚

## ---


---

## **éšæ®µä¸‰ï¼šé©—è­‰èˆ‡å£“åŠ›æ¸¬è©¦ (Verification)**

### **3.1 å‰é›¢ç ”ç©¶ (Ablation Study)**
åœ¨ **Final (æ¸…æ´—çµ„)** æ•¸æ“šæ± ä¸Šï¼Œæ¯”è¼ƒä»¥ä¸‹å ´æ™¯ï¼š

1.  **V5.3 (Full):** L1 æ··åˆé˜²ç¦¦ + L4 å‹•æ…‹å‡ºå ´ (éš”æ—¥æ›´æ–°)ã€‚
2.  **V5.3 (No L1):** åƒ… L4 å‹•æ…‹å‡ºå ´ (æ¸¬è©¦ L4 è‡ªèº«çš„ç²åˆ©èƒ½åŠ›)ã€‚
3.  **V5.3 (No Stop / æ­»æŠ±):** **(é—œéµå°ç…§)** é—œé–‰ L4 èˆ‡æ™‚é–“æ­¢æï¼ŒæŒæœ‰ç›´åˆ°è§¸ç™¼ L1 ç†”æ–·æˆ– RSI > 90 æ¥µç«¯è¨Šè™Ÿã€‚
    * *ç›®çš„:* é©—è­‰åœ¨ã€Œç„¡æ³•ç›¤ä¸­ç§»å‹•æ­¢æã€çš„åŠ£å‹¢ä¸‹ï¼ŒL4 æ˜¯å¦ä»å„ªæ–¼æ­»æŠ±ã€‚å¦‚æœæ­»æŠ±ç¸¾æ•ˆæ›´å¥½ï¼Œä»£è¡¨ L4 è¢«æ´—å‡ºå ´çš„é »ç‡éé«˜ã€‚
4.  **V5.2 (Benchmark):** å›ºå®š 5 å¤© + ç¡¬æ€§ç†”æ–· (æ¸¬è©¦ V5.3 æ˜¯å¦è¶…è¶Šå‰ä»£)ã€‚

### **3.2 æ¯’æ€§ç”Ÿå­˜æ¸¬è©¦ (Survivorship Stress Test)**
* å°ˆæ³¨è§€å¯Ÿ `final_toxic_asset_pool.json` ä¸­çš„æ¨™çš„ã€‚
* **æˆåŠŸæ¨™æº–:** V5.3 åœ¨æ¯’æ€§æ± ä¸­çš„ MaxDD éœ€å„ªæ–¼ V5.2ï¼Œä¸”ç¸½å›å ±ä¸æ‡‰æ­¸é›¶ã€‚

---

## **åŸ·è¡Œé †åº (Execution Steps)**

1.  **[Step 0] æ•¸æ“šæ¸…æ´—:** åŸ·è¡Œ `00_download_custom.py` -> `00_audit_data.py` (è¼¸å…¥ Standard -> è¼¸å‡º Final)ã€‚
2.  **[Step 1] å»ºç«‹åŸºæº–:** åŸ·è¡Œ `05_backtest_benchmarks.py` (Origin/Standard/Final ä¸‰è»Œä¸¦è¡Œ)ã€‚
3.  **[Step 2] é–‹ç™¼ V5.3:** ä¿®æ”¹ `risk_manager.py` (L4/L1) èˆ‡ `backtesting_utils.py` (å¯¦ä½œ T-1/T Open é‚è¼¯)ã€‚
4.  **[Step 3] æœ€çµ‚å›æ¸¬:** åŸ·è¡Œ `06_backtest_v5.3.py` (åŸºæ–¼ Final çµ„)ã€‚

---

## **æœªä¾†å±•æœ› (Future Work): V5.4 Track B é€²éšçœŸå¯¦æ€§ç ”ç©¶**

**ç›®æ¨™:** å¾ V5.3 çš„ã€Œå·²çŸ¥æ¯’æ€§æ¨¡æ“¬ã€é€²éšåˆ°ã€ŒæœªçŸ¥æ¯’æ€§æ¢ç´¢ã€ï¼Œè§£æ±º yfinance æ•¸æ“šçš„å…ˆå¤©ç¼ºé™·ã€‚

### **1. æ›´ç´°é¡†ç²’åº¦çš„ OHLCV (High-Frequency Data)**
* **æ•¸æ“šéœ€æ±‚:** 5m æˆ– 15m Kç·šæ•¸æ“š (éœ€ä»˜è²»æˆ–é€é IBKR API ç²å–)ã€‚
* **æ‡‰ç”¨å ´æ™¯:**
    * **ç›¤ä¸­è·¯å¾‘æ¨¡æ“¬:** V5.3 å‡è¨­ `Low < Stop_Price` å³è§¸ç™¼æ­¢æï¼Œä½†ç„¡æ³•ç¢ºå®šæ˜¯åœ¨é–‹ç›¤å³è§¸ç™¼é‚„æ˜¯æ”¶ç›¤å‰è§¸ç™¼ã€‚é«˜é »æ•¸æ“šèƒ½ç²¾ç¢ºé‚„åŸ **è§¸ç™¼æ™‚é–“é»** èˆ‡ **æ»‘åƒ¹å¹…åº¦**ã€‚
    * **å¾®çµæ§‹ç‰¹å¾µ:** è¨ˆç®—æ—¥å…§ **VPIN (Volume-Synchronized Probability of Informed Trading)** æˆ– **è²·è³£å£“å¤±è¡¡ (Order Flow Imbalance)**ï¼Œä½œç‚º L1 é˜²ç¦¦çš„æ–°å› å­ï¼Œæ•æ‰å¤§æˆ¶å‡ºè²¨è·¡è±¡ã€‚

### **2. Track B (å…¨çœŸæ³• - Reality Check)**
æ­¤éšæ®µå°‡ä½¿ç”¨ä»˜è²»çš„ **Point-in-Time (PIT)** è³‡æ–™åº« (å¦‚ Norgate Data, Sharadar, Polygon.io)ã€‚

* **æ ¸å¿ƒæŠ€è¡“: å‹•æ…‹è‚¡ç¥¨æ±  (Dynamic Universe Construction)**
    * **ç›®å‰å•é¡Œ:** V5.3 ä½¿ç”¨çš„æ˜¯ 2025 å¹´çš„ã€Œå€–å­˜è€…æ¸…å–®ã€ã€‚æˆ‘å€‘çŸ¥é“ NVDA ç¾åœ¨å¾ˆæˆåŠŸï¼Œæ‰€ä»¥åœ¨ 2016 å¹´è²·å®ƒã€‚
    * **è§£æ±ºæ–¹æ¡ˆ:** å»ºç«‹ `get_historical_universe(date)` å‡½æ•¸ã€‚
        * ä¾‹å¦‚ï¼šåœ¨ `2016-01-01` å›æ¸¬æ™‚ï¼Œç³»çµ±æŸ¥è©¢è³‡æ–™åº«ï¼šã€Œç•¶å¤© S&P 500 çš„æˆåˆ†è‚¡æ˜¯å“ªäº›ï¼Ÿã€
        * å›å‚³æ¸…å–®å°‡åŒ…å« **Sears (å·²ä¸‹å¸‚)**ã€**Lehman Brothers (å·²ä¸‹å¸‚)** ç­‰ç•¶å¹´çš„å¤§å‹è‚¡ï¼Œè€Œ**ä¸åŒ…å«**ç•¶æ™‚é‚„æœªä¸Šå¸‚æˆ–æœªå…¥é¸çš„è‚¡ç¥¨ã€‚
* **é©—è­‰ç›®æ¨™:**
    * **æ•æ‰ã€ŒæœªçŸ¥çš„åœ°é›·è‚¡ã€ (Unknown Unknowns):** æ‰¾å‡ºé‚£äº›æˆ‘å€‘æ²’è½éã€ä½†åœ¨æ­·å²ä¸Šæ›¾é€ æˆè™§æçš„è‚¡ç¥¨ã€‚
    * **çœŸå¯¦ç”Ÿå­˜ç‡:** åœ¨åŒ…å«æ•¸åƒæª”ã€Œå·²æ­»äº¡ã€è‚¡ç¥¨çš„çœŸå¯¦æ­·å²æ´ªæµä¸­ï¼Œé©—è­‰ V5.3 çš„é¢¨æ§é‚è¼¯æ˜¯å¦ä¾ç„¶æœ‰æ•ˆï¼Œæˆ–è€…ç¸¾æ•ˆæœƒå¤§å¹…ç¸®æ°´ (Alpha Decay)ã€‚