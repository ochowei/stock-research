# **ç ”ç©¶è¨ˆç•«ï¼šV5.3-Dynamic (Track A) æ•¸æ“šæª¢æ ¸èˆ‡å‹•æ…‹æ”»é˜²ç³»çµ± (Final Revised v4)**

**Date:** 2025-12-04
**Focus:** ğŸŸ¢ **Free Data Only (yfinance)**
**Constraint:** ğŸ‡¹ğŸ‡¼ **Taiwan Timezone Operator (No Intraday Monitoring)**
**Goal:** åœ¨å…è²»æ•¸æ“šèˆ‡ã€Œéš”å¤œæ“ä½œã€é™åˆ¶ä¸‹ï¼Œé©—è­‰å‹•æ…‹é¢¨æ§çš„æœ‰æ•ˆæ€§ã€‚

## **éšæ®µä¸€ï¼šæ•¸æ“šå¯©è¨ˆèˆ‡åŸºæº–é‡ç¾ (Data Audit & Baselining)**

**ç›®æ¨™ï¼š** åœ¨é–‹ç™¼æ–°åŠŸèƒ½å‰ï¼Œå…ˆç¢ºä¿æ•¸æ“šå“è³ªï¼Œä¸¦å»ºç«‹æ¸…æ´—å¾Œçš„æ¨™æº–æ¸¬è©¦é›†ã€‚

### **1.1 å·¥ä½œé …ç›®ï¼šæ•¸æ“šè¦†è“‹ç‡åˆ†æèˆ‡æ¸…æ´— (Data Sufficiency Analysis & Cleaning)**
* **åŸ·è¡Œå‹•ä½œ (æ’°å¯« `00_audit_data.py`):**
    1.  **å‚™ä»½åŸå§‹æ¸…å–®ï¼š** å°‡ V5.2 çš„åŸå§‹æª”æ¡ˆé‡æ–°å‘½åç‚º `origin_asset_pool.json` èˆ‡ `origin_toxic_asset_pool.json`ã€‚
    2.  **æ•¸æ“šå¯©è¨ˆï¼š** è¨ˆç®—æ¯æª”æ¨™çš„åœ¨ 2015-2025 é–“çš„ã€Œæœ‰æ•ˆäº¤æ˜“æ—¥ã€æ¯”ä¾‹èˆ‡æˆäº¤é‡å¯†åº¦ã€‚
    3.  **æ¸…æ´—èˆ‡ç”Ÿæˆï¼š** ç”Ÿæˆç¶“éæ¸…æ´—çš„ **æ–°ç‰ˆ** `asset_pool.json` èˆ‡ `toxic_asset_pool.json`ã€‚
    4.  **ç”¢å‡ºå ±å‘Šï¼š** ç”Ÿæˆ `data_selection_report.md`ã€‚
    5.  **è¦†è“‹ç‡è¦–è¦ºåŒ–ï¼š** ç”¢å‡º `data_coverage_over_time.png`ã€‚

### **1.2 å·¥ä½œé …ç›®ï¼šåŸºæº–ç·šé‡ç¾ (Benchmark Re-implementation)**
* **ç›®æ¨™ï¼š** ä½¿ç”¨ **æ¸…æ´—å¾Œçš„æ–°ç‰ˆæ¸…å–®** è·‘å‡º V5.1 èˆ‡ V5.2 çš„æˆç¸¾å–®ã€‚
* **åŸ·è¡Œå‹•ä½œ:**
    * **Benchmark A (V5.1 Aggressive):** é‚è¼¯: `Fixed 5-Day` + `No Filter` + `Equal Weight`ã€‚
    * **Benchmark B (V5.2 Risk-Aware):** é‚è¼¯: `Fixed 5-Day` + `Breadth Filter` + `ATR Sizing` (å³ V5.2 Full System)ã€‚
    * **ç”¢å‡º:** `analysis/baseline_performance.csv`ã€‚

---

## **éšæ®µäºŒï¼šæ ¸å¿ƒç³»çµ±å¯¦ä½œ (Core Implementation - Track A)**

### **2.1 å¯¦ç›¤æ“ä½œé™åˆ¶ (Operational Constraints - ğŸ‡¹ğŸ‡¼ Taiwan User)**
* **æƒ…å¢ƒ:** æ“ä½œè€…ä½æ–¼å°ç£ï¼Œä½¿ç”¨ Firstradeï¼Œç„¡æ³•åœ¨ç¾è‚¡ç›¤ä¸­ç›¯ç›¤ã€‚
* **æµç¨‹é™åˆ¶ (Workflow):**
    1.  **T-1 æ—¥æ”¶ç›¤å¾Œ (å°ç£æ™‚é–“æ—©æ™¨):** ä¸‹è¼‰æˆªè‡³ `T-1` çš„æ•¸æ“šã€‚
    2.  **é›¢ç·šè¨ˆç®—:** è¨ˆç®— L1 é¢¨éšªç‹€æ…‹ã€L2 è¨Šè™Ÿã€L4 æ­¢æåƒ¹æ ¼ã€‚
    3.  **T æ—¥é–‹ç›¤å‰ (å°ç£æ™‚é–“æ™šä¸Š):** é æ› `T` æ—¥çš„è¨‚å–®ã€‚
        * **é€²å ´å–®:** å¸‚åƒ¹å–® (Market Order) -> é æœŸåœ¨ `T_Open` æˆäº¤ã€‚
        * **å‡ºå ´å–®:** åœæå¸‚åƒ¹å–® (Stop Market Order) -> è§¸ç™¼åƒ¹ç‚ºå›ºå®šå€¼ (åŸºæ–¼ `T-1` æ•¸æ“šè¨ˆç®—)ã€‚
* **å›æ¸¬åš´æ ¼è¦æ±‚:**
    * ç¦æ­¢ä½¿ç”¨ `T` æ—¥çš„ `High/Low/Close` ä¾†æ±ºå®šæ˜¯å¦åœ¨ `T` æ—¥ã€Œé€²å ´ã€ã€‚
    * `T` æ—¥çš„å‡ºå ´åƒ…èƒ½ç”±ã€Œé æ›çš„åœæå–®ã€è§¸ç™¼ (å³ `T_Low < Stop_Price`)ï¼Œæˆ–æŒæœ‰æœŸæ»¿çš„ `T_Open` å‡ºå ´ã€‚

### **2.2 L4 å‡ºå ´å±¤ï¼šéš”æ—¥æ›´æ–°å‹•æ…‹æ­¢ç›ˆ (Daily-Updated Trailing Stop)**
* **æ©Ÿåˆ¶:** å–ä»£ V5.2 çš„å›ºå®š 5 å¤©å‡ºå ´ã€‚
* **é‚è¼¯ (é…åˆå¯¦ç›¤é™åˆ¶):**
    * æ­¢æåƒ¹ ($Stop\_Price_T$) å¿…é ˆåœ¨ `T` æ—¥é–‹ç›¤å‰æ±ºå®šã€‚
    * $Stop\_Price_T = Highest\_High_{(Entry \to T-1)} - (K \times ATR_{T-1})$
    * **æ„ç¾©:** æˆ‘å€‘åªèƒ½æ ¹æ“šã€Œæ˜¨å¤©ç‚ºæ­¢ã€çš„æœ€é«˜åƒ¹ä¾†è¨­ä»Šå¤©çš„é˜²å®ˆé»ã€‚å¦‚æœä»Šå¤© (`T`) è‚¡åƒ¹å¤§æ¼²å‰µæ–°é«˜ï¼Œæ­¢æé»**ä¸æœƒ**åœ¨ç›¤ä¸­è·Ÿè‘—ä¸Šç§»ï¼Œå¿…é ˆç­‰åˆ°æ˜å¤© (`T+1`) æ‰èƒ½æ›´æ–°ã€‚
* **å‹•æ…‹ K:** ç•¶ `RSI(T-1) > 70` æˆ– `L1_Risk(T-1) = High` æ™‚ï¼Œç·Šç¸®è‡³ $K=1.5$ã€‚

### **2.3 äº¤æ˜“æˆæœ¬æ¨¡å‹ (Transaction Cost Model)**
* **åˆ¸å•†å‡è¨­:** **Firstrade (Zero Commission)**ã€‚
* **åƒæ•¸è¨­å®š:**
    * **Commission:** **0 bps**ã€‚
    * **Regulatory Fees:** **1 bps** (è³£å‡ºè¦è²»)ã€‚
    * **Slippage (æ»‘åƒ¹):**
        * **Entry (Market on Open):** **5 bps** (é–‹ç›¤å¸‚åƒ¹å–®æ»‘åƒ¹)ã€‚
        * **Trailing Exit (Stop Market):** **10 bps** (è§¸ç™¼åœææ™‚çš„æ»‘åƒ¹)ã€‚

### **2.4 L1 é˜²ç¦¦å±¤ï¼šæ··åˆå¼å´©ç›¤é è­¦ (Hybrid Defense)**
* **A. ç¡¬æ€§ç†”æ–·:** `Breadth(T-1) < 15%` -> å¼·åˆ¶åœ¨ `T_Open` æ¸…å€‰ã€‚
* **B. é æ¸¬æ¨¡çµ„:** æ ¹æ“š `T-1` çš„ VIX èˆ‡åƒ¹æ ¼è¡Œç‚ºé æ¸¬é¢¨éšªï¼Œèª¿æ•´ L4 åƒæ•¸ã€‚

---

## **éšæ®µä¸‰ï¼šé©—è­‰èˆ‡å£“åŠ›æ¸¬è©¦ (Verification)**

### **3.1 å‰é›¢ç ”ç©¶ (Ablation Study)**
åœ¨åŒä¸€ä»½æ•¸æ“šæ±  (æ¸…æ´—å¾Œçš„ Normal + Toxic) ä¸Šï¼Œæ¯”è¼ƒä»¥ä¸‹å ´æ™¯ï¼š

1.  **V5.3 (Full):** L1 æ··åˆé˜²ç¦¦ + L4 å‹•æ…‹å‡ºå ´ (éš”æ—¥æ›´æ–°)ã€‚
2.  **V5.3 (No L1):** åƒ… L4 å‹•æ…‹å‡ºå ´ã€‚
3.  **V5.3 (No Stop / æ­»æŠ±):** é—œé–‰ L4 èˆ‡æ™‚é–“æ­¢æï¼ŒæŒæœ‰ç›´åˆ°è§¸ç™¼ L1 ç†”æ–·æˆ– RSI æ¥µç«¯è¨Šè™Ÿã€‚
    * *ç›®çš„:* é©—è­‰åœ¨ã€Œç„¡æ³•ç›¤ä¸­ç§»å‹•æ­¢æã€çš„åŠ£å‹¢ä¸‹ï¼ŒL4 æ˜¯å¦ä»å„ªæ–¼æ­»æŠ±ã€‚
4.  **V5.2 (Benchmark):** å›ºå®š 5 å¤© + ç¡¬æ€§ç†”æ–·ã€‚

### **3.2 æ¯’æ€§ç”Ÿå­˜æ¸¬è©¦ (Survivorship Stress Test)**
* å°ˆæ³¨è§€å¯Ÿ **æ¸…æ´—å¾Œæ–°ç‰ˆ** `toxic_asset_pool.json` ä¸­çš„æ¨™çš„ã€‚
* **æˆåŠŸæ¨™æº–:** V5.3 åœ¨æ¯’æ€§æ± ä¸­çš„ MaxDD éœ€å„ªæ–¼ V5.2ï¼Œä¸”ç¸½å›å ±ä¸æ‡‰æ­¸é›¶ã€‚

---

## **åŸ·è¡Œé †åº (Execution Steps)**

1.  **[Step 0] æ•¸æ“šæ¸…æ´—:** åŸ·è¡Œ `00_download_custom.py` -> `00_audit_data.py` (ç”¢å‡ºæ–°æ¸…å–®)ã€‚
2.  **[Step 1] å»ºç«‹åŸºæº–:** åŸ·è¡Œ `05_backtest_benchmarks.py` (V5.1/V5.2)ã€‚
3.  **[Step 2] é–‹ç™¼ V5.3:**
    * ä¿®æ”¹ `risk_manager.py`: å¯¦ä½œ `update_trailing_stop(T-1_High, ATR)`ã€‚
    * ä¿®æ”¹ `backtesting_utils.py`: å¯¦ä½œ **T-1 æ±ºç­– / T Open åŸ·è¡Œ** çš„åš´æ ¼æ™‚åºé‚è¼¯ã€‚
4.  **[Step 3] æœ€çµ‚å›æ¸¬:** åŸ·è¡Œ `06_backtest_v5.3.py` (å«æ‰€æœ‰å‰é›¢å ´æ™¯)ã€‚

---

## **æœªä¾†å±•æœ› (Future Work): V5.4 Track B é€²éšç ”ç©¶**

**ç›®æ¨™:** å¼•å…¥ä»˜è²»èˆ‡é«˜è§£æåº¦æ•¸æ“šï¼Œè§£æ±ºã€ŒæœªçŸ¥å€–å­˜è€…åå·®ã€ä¸¦å„ªåŒ–åŸ·è¡Œç´°ç¯€ã€‚

### **1. æ›´ç´°é¡†ç²’åº¦çš„ OHLCV (High-Frequency Data)**
* **æ•¸æ“šä¾†æº:** yfinance (è¿‘æœŸ) æˆ–ä»˜è²»æº (5m/15m)ã€‚
* **ç›®çš„:** æ¨¡æ“¬ç›¤ä¸­è§¸ç™¼ L4 æ­¢æçš„çœŸå¯¦åƒ¹æ ¼ã€‚

### **2. Track B (é€²éšåŸ·è¡Œ - Paid / Sharadar or Polygon)**
* **æ•¸æ“š:** **Point-in-Time (PIT)** æ­·å²åƒ¹æ ¼èˆ‡åŸºæœ¬é¢è³‡æ–™åº« (å«å·²ä¸‹å¸‚è‚¡ç¥¨)ã€‚
* **åå·®è™•ç†:** **å…¨çœŸæ³• (Reality Check)**ã€‚
    * **å‹•æ…‹è‚¡ç¥¨æ±  (Dynamic Universe):** é‡å»ºæ¯ä¸€å¤©æ­·å²ç•¶ä¸‹çœŸå¯¦å­˜åœ¨çš„è‚¡ç¥¨æ¸…å–®ã€‚
* **ç›®çš„:** æ•æ‰ã€ŒæœªçŸ¥çš„åœ°é›·è‚¡ã€ï¼Œé©—è­‰ç­–ç•¥åœ¨çœŸå¯¦æ­·å²æ´ªæµä¸­çš„ç”Ÿå­˜ç‡ã€‚
