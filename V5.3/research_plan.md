# ç ”ç©¶è¨ˆç•«ï¼šV5.3-Dynamic (Track A) æ•¸æ“šæª¢æ ¸èˆ‡å‹•æ…‹æ”»é˜²ç³»çµ± (Final Revised v7.1)

**Date:** 2025-12-04 (Updated: Added Dataset Definitions)
**Focus:** ğŸŸ¢ **Free Data Only (yfinance)**
**Constraint:** ğŸ‡¹ğŸ‡¼ **Taiwan Timezone (T-1 Decision / T Open Execution)**
**Goal:** åœ¨å…è²»æ•¸æ“šèˆ‡å¯¦ç›¤é™åˆ¶ä¸‹ï¼Œé©—è­‰å‹•æ…‹é¢¨æ§çš„æœ‰æ•ˆæ€§ï¼Œä¸¦ç‚º V5.4 çš„å…¨çœŸå›æ¸¬å¥ å®šåŸºç¤ã€‚

---

## **éšæ®µä¸€ï¼šæ•¸æ“šå¯©è¨ˆèˆ‡åŸºæº–é‡ç¾ (Data Audit & Baselining)**

**ç›®æ¨™ï¼š** åœ¨é–‹ç™¼æ–°åŠŸèƒ½å‰ï¼Œå…ˆç¢ºä¿æ•¸æ“šå“è³ªï¼Œä¸¦å»ºç«‹æ¸…æ´—å¾Œçš„æ¨™æº–æ¸¬è©¦é›†ï¼Œé‡åŒ–ã€Œç¯©é¸åå·®ã€çš„å½±éŸ¿ã€‚

### **1.1 å·¥ä½œé …ç›®ï¼šæ•¸æ“šè¦†è“‹ç‡åˆ†æèˆ‡æ¸…æ´— (Data Sufficiency Analysis & Cleaning)**
* **å•é¡Œï¼š** ç¹¼æ‰¿è‡ª V5.2 çš„æ¸…å–®æ˜¯éœæ…‹çš„ï¼Œå¯èƒ½åŒ…å«åœ¨æ—©æœŸå¹´ä»½ï¼ˆå¦‚ 2015-2018ï¼‰å°šæœªä¸Šå¸‚æˆ–æµå‹•æ€§ä¸è¶³çš„æ¨™çš„ã€‚
* **åŸ·è¡Œå‹•ä½œ (æ’°å¯« `00_audit_data.py`):**
    1.  **è®€å–èˆ‡å¯©è¨ˆï¼š** è®€å– `Standard`( asset_pool.json, toxic_asset_pool.json) æ¸…å–®ï¼Œæª¢æŸ¥æ¯æª”æ¨™çš„åœ¨ 2015-2025 é–“çš„ã€Œæœ‰æ•ˆäº¤æ˜“æ—¥ã€èˆ‡ã€Œæµå‹•æ€§ã€ã€‚
    2.  **ç”Ÿæˆæ¸…æ´—æ¸…å–®ï¼š** å°‡ç¬¦åˆæ¨™æº–çš„æ¨™çš„å¯«å…¥ `Final` æ¸…å–®ã€‚
    3.  **ç”¢å‡ºå ±å‘Šï¼š** ç”Ÿæˆ `data_selection_report.md` èˆ‡ `data_coverage_over_time.png`ã€‚

### **1.2 å·¥ä½œé …ç›®ï¼šåŸºæº–ç·šé‡ç¾ (Benchmark Re-implementation)**
* **ç›®æ¨™ï¼š** ä½¿ç”¨ä¸‰çµ„ä¸åŒå“è³ªçš„æ¸…å–®è·‘åˆ†ï¼Œé‡åŒ–ã€Œå€–å­˜è€…åå·®ã€èˆ‡ã€Œæ•¸æ“šæ¸…æ´—ã€å°ç¸¾æ•ˆçš„å½±éŸ¿ã€‚
* **åŸ·è¡Œå‹•ä½œ (æ’°å¯« `05_backtest_benchmarks.py`):**
    * å°ä¸‰çµ„è³‡æ–™é›†åˆ†åˆ¥åŸ·è¡Œ V5.1 èˆ‡ V5.2 å›æ¸¬ã€‚

### **1.3 [NEW] è³‡æ–™é›†å®šç¾© (Dataset Definitions)**
ç‚ºäº†ç²¾ç¢ºè©•ä¼°æ•¸æ“šå“è³ªå°ç­–ç•¥çš„å½±éŸ¿ï¼Œæœ¬è¨ˆç•«å®šç¾©ä¸‰å±¤ç´šçš„è³‡ç”¢æ± ï¼š

| è³‡æ–™é›† (Dataset) | æª”æ¡ˆå‰ç¶´ (Prefix) | æª”æ¡ˆåç¨± (Files) | å®šç¾©èˆ‡ç”¨é€” (Definition & Usage) |
| :--- | :--- | :--- | :--- |
| **Origin (åŸå§‹çµ„)** | `origin` | `origin_asset_pool.json`<br>`origin_toxic_asset_pool.json` | **æ­·å²éºè·¡**ã€‚ç¹¼æ‰¿è‡ª V5.2 æˆ–æ›´æ—©æœŸçš„åŸå§‹æ¸…å–®ï¼Œå®Œå…¨æœªç¶“ V5.3 æ¨™æº–å¯©è¨ˆã€‚ç”¨æ–¼å‘ˆç¾ã€Œæœ€åŸå§‹ã€æœªç¶“ä¿®é£¾ã€çš„åŸºç·šã€‚ |
| **Standard (æ¨™æº–çµ„)** | `standard` | `asset_pool.json`<br>`toxic_asset_pool.json` | **ç•¶å‰è¼¸å…¥**ã€‚ä½œç‚º `00_audit_data.py` çš„ä¸»è¦è¼¸å…¥ä¾†æº (Input)ã€‚ä»£è¡¨å°šæœªé€²è¡Œæœ¬æ¬¡åš´æ ¼æ¸…æ´—å‰çš„ç‹€æ…‹ã€‚ |
| **Final (æ¸…æ´—çµ„)** | `final` | `final_asset_pool.json`<br>`final_toxic_asset_pool.json` | **æœ€çµ‚è¼¸å‡º**ã€‚é€šé `00_audit_data.py` åš´æ ¼å¯©è¨ˆ (è¦†è“‹ç‡ > 200å¤©/å¹´, éé›¶æˆäº¤) å¾Œçš„é»ƒé‡‘æ¸…å–®ã€‚**V5.3 çš„æ ¸å¿ƒé–‹ç™¼èˆ‡é©—è­‰å°‡ä»¥æ­¤çµ„ç‚ºæº–ã€‚** |

---

## **éšæ®µäºŒï¼šæ ¸å¿ƒç³»çµ±å¯¦ä½œ (Core Implementation - Track A)**

*(æ­¤éšæ®µæ‰€æœ‰æ•¸æ“šçš†ä¾†è‡ª yfinance OHLCVï¼Œç„¡éœ€ä»˜è²»)*

### **2.1 å¯¦ç›¤æ“ä½œé™åˆ¶ (Operational Constraints)**
* **æƒ…å¢ƒ:** æ“ä½œè€…ä½æ–¼å°ç£ï¼Œç„¡æ³•åœ¨ç¾è‚¡ç›¤ä¸­ç›¯ç›¤ã€‚
* **æµç¨‹:**
    1.  **T-1 æ”¶ç›¤å¾Œ:** ä¸‹è¼‰æ•¸æ“šï¼Œè¨ˆç®—è¨Šè™Ÿã€‚
    2.  **T æ—¥é–‹ç›¤å‰:** é æ›è¨‚å–®ã€‚
* **äº¤æ˜“åŸ·è¡Œ (Execution):**
    * **é€²å ´:** T æ—¥é–‹ç›¤å¸‚åƒ¹å–® (Market on Open)ã€‚
    * **å‡ºå ´:** T æ—¥é–‹ç›¤å‰æ›å‡º **åœæå¸‚åƒ¹å–® (Stop Market Order)**ï¼Œè§¸ç™¼åƒ¹åŸºæ–¼ T-1 æ•¸æ“šå›ºå®šï¼ˆç›¤ä¸­ä¸ç§»å‹•ï¼‰ã€‚

### **2.2 L4 å‡ºå ´å±¤ï¼šéš”æ—¥æ›´æ–°å‹•æ…‹æ­¢ç›ˆ (Daily-Updated Trailing Stop)**
* **æ©Ÿåˆ¶:** å–ä»£ V5.2 çš„å›ºå®š 5 å¤©å‡ºå ´ã€‚
* **é‚è¼¯:**
    * æ­¢æåƒ¹ ($Stop\_Price_T$) å¿…é ˆåœ¨ `T` æ—¥é–‹ç›¤å‰æ±ºå®šã€‚
    * $Stop\_Price_T = Highest\_High_{(Entry \to T-1)} - (K \times ATR_{T-1})$
* **å‹•æ…‹ K å€¼:**
    * **é è¨­:** $K=3.0$ (è®“åˆ©æ½¤å¥”è·‘)ã€‚
    * **ç·Šç¸®:** ç•¶ `RSI(T-1) > 70` æˆ– `L1_Risk(T-1) = High` æ™‚ï¼Œç·Šç¸®è‡³ $K=1.5$ (å¿«é€Ÿé–åˆ©)ã€‚

### **2.3 äº¤æ˜“æˆæœ¬æ¨¡å‹ (Transaction Cost Model)**
* **åˆ¸å•†å‡è¨­:** **Firstrade / IBKR Lite (Zero Commission)**ã€‚
* **åƒæ•¸è¨­å®š:**
    * **Commission (ä½£é‡‘):** **0 bps**ã€‚
    * **Regulatory Fees (è¦è²»):** **1 bps** (é ç•™çµ¦ SEC/TAF è³£å‡ºè¦è²»)ã€‚
    * **Slippage (æ»‘åƒ¹):**
        * **Entry (Market on Open):** **5 bps** (é–‹ç›¤å¸‚åƒ¹å–®æ»‘åƒ¹)ã€‚
        * **Trailing Exit (Stop Market):** **10 bps** (æ¨¡æ“¬è§¸ç™¼æ­¢ææ™‚ï¼Œå¸‚åƒ¹å–®é€ æˆçš„è¼ƒå¤§æ»‘åƒ¹)ã€‚

### **2.4 L1 é˜²ç¦¦å±¤ï¼šæ··åˆå¼å´©ç›¤é è­¦ (Hybrid Defense)**
* **A. ç¡¬æ€§ç†”æ–·:** `Breadth(T-1) < 15%` -> å¼·åˆ¶ `T_Open` æ¸…å€‰ã€‚
* **B. é æ¸¬æ¨¡çµ„ (Price Action XGBoost):**
    * åˆ©ç”¨ VIX æ–œç‡èˆ‡å¯¬åº¦æŒ‡æ¨™é æ¸¬çŸ­æœŸæ³¢å‹•ã€‚
    * **Action:** åƒ…èª¿æ•´ L4 åƒæ•¸ï¼ˆç·Šç¸® K å€¼ï¼‰ï¼Œä¸å¼·åˆ¶æ¸…å€‰ï¼ˆé™¤éè§¸ç™¼ç¡¬æ€§ç†”æ–·ï¼‰ã€‚

---

## **éšæ®µä¸‰ï¼šé©—è­‰èˆ‡å£“åŠ›æ¸¬è©¦ (Verification)**

### **3.1 å‰é›¢ç ”ç©¶ (Ablation Study)**
åœ¨ **Final (æ¸…æ´—çµ„)** æ•¸æ“šæ± ä¸Šï¼Œæ¯”è¼ƒä»¥ä¸‹å ´æ™¯ï¼š

1.  **V5.3 (Full):** L1 æ··åˆé˜²ç¦¦ + L4 å‹•æ…‹å‡ºå ´ (éš”æ—¥æ›´æ–°)ã€‚
2.  **V5.3 (No L1):** åƒ… L4 å‹•æ…‹å‡ºå ´ (æ¸¬è©¦ L4 è‡ªèº«çš„ç²åˆ©èƒ½åŠ›)ã€‚
3.  **V5.3 (No Stop / æ­»æŠ±):** **(é—œéµå°ç…§)** é—œé–‰ L4 èˆ‡æ™‚é–“æ­¢æï¼ŒæŒæœ‰ç›´åˆ°è§¸ç™¼ L1 ç†”æ–·æˆ– RSI > 90 æ¥µç«¯è¨Šè™Ÿã€‚
4.  **V5.2 (Benchmark):** å›ºå®š 5 å¤© + ç¡¬æ€§ç†”æ–·ã€‚

### **3.2 æ¯’æ€§ç”Ÿå­˜æ¸¬è©¦ (Survivorship Stress Test)**
* å°ˆæ³¨è§€å¯Ÿ `final_toxic_asset_pool.json` ä¸­çš„æ¨™çš„ã€‚
* **æˆåŠŸæ¨™æº–:** V5.3 åœ¨æ¯’æ€§æ± ä¸­çš„ MaxDD éœ€å„ªæ–¼ V5.2ï¼Œä¸”ç¸½å›å ±ä¸æ‡‰æ­¸é›¶ã€‚

---

## **åŸ·è¡Œé †åº (Execution Steps)**

1.  **[Step 0] æ•¸æ“šæ¸…æ´—:** åŸ·è¡Œ `00_download_custom.py` -> `00_audit_data.py` (è¼¸å…¥ Standard -> è¼¸å‡º Final)ã€‚
2.  **[Step 1] å»ºç«‹åŸºæº–:** åŸ·è¡Œ `05_backtest_benchmarks.py` (Origin/Standard/Final ä¸‰è»Œä¸¦è¡Œ)ã€‚
3.  **[Step 2] é–‹ç™¼ V5.3:** ä¿®æ”¹ `risk_manager.py` (L4/L1) èˆ‡ `backtesting_utils.py` (å¯¦ä½œ T-1/T Open é‚è¼¯)ã€‚
4.  **[Step 3] æœ€çµ‚å›æ¸¬:** åŸ·è¡Œ `06_backtest_v5.3.py` (åŸºæ–¼ Final çµ„)ã€‚

---

## **æœªä¾†å±•æœ› (Future Work): V5.4 Track B**
* **æ ¸å¿ƒæŠ€è¡“:** å‹•æ…‹è‚¡ç¥¨æ±  (Dynamic Universe Construction) èˆ‡ Point-in-Time Dataã€‚
* **ç›®æ¨™:** è§£æ±º yfinance çš„å€–å­˜è€…åå·®ï¼Œé€²è¡Œå…¨çœŸæ­·å²å›æ¸¬ã€‚