name: Manual Gap Signal Generator

# 設定觸發條件為「手動點擊按鈕」(workflow_dispatch)
on:
  workflow_dispatch:
    inputs:
      branch:
        description: 'Branch to run (default: current)'
        required: false
        default: ''

jobs:
  run-gap-signal:
    runs-on: ubuntu-latest
    
    steps:
      # 1. 下載程式碼
      - name: Checkout code
        uses: actions/checkout@v4

      # 2. 設定 Python 環境
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.10'
          cache: 'pip' # 啟用快取以加速後續執行

      # 3. 安裝依賴套件
      # 根據您的 import 內容，安裝必要的庫
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install pandas numpy yfinance tqdm

      # 4. 執行腳本
      # 使用 pipe (echo "q" | ...) 來處理腳本最後的 input() 阻塞問題
      - name: Run Daily Gap Signal Generator
        run: |
          python V6.0/exp-3.0/daily_gap_signal_generator.py

      # 5. 上傳產出的 CSV 檔案作為 Artifact
      # 這樣您執行完後可以直接在 GitHub 頁面下載報表
      - name: Upload Results
        uses: actions/upload-artifact@v4
        with:
          name: gap-signal-report
          path: V6.0/exp-3.0/output/*.csv
          retention-days: 5
