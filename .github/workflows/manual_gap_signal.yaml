name: Manual Gap Signal Generator

# 設定觸發條件為「手動點擊按鈕」(workflow_dispatch)
on:
  workflow_dispatch:
    inputs:
      branch:
        description: 'Branch to run (default: current)'
        required: false
        default: ''
        
  schedule:
    # UTC 13:15
    # 夏令時間 (EDT, 3月-11月): 對應美東 09:15 AM (開盤前 15 分鐘)
    # 冬令時間 (EST, 11月-3月): 對應美東 08:15 AM (開盤前 1 小時 15 分鐘)
    - cron: '15 14 * * 1-5'

jobs:
  run-gap-signal:
    runs-on: ubuntu-latest
    
    steps:
      # 1. 下載程式碼
      - name: Checkout code
        uses: actions/checkout@v4

      # 2. 設定 Python 環境
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.10'
          cache: 'pip' # 啟用快取以加速後續執行

      # 3. 安裝依賴套件
      # 根據您的 import 內容，安裝必要的庫 (V6.1 腳本主要依賴這些套件)
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install pandas numpy yfinance tqdm

      # 4. 執行腳本
      # 執行 V6.1 版本的 Daily Gap Signal Generator
      - name: Run Daily Gap Signal Generator
        run: |
          python V6.1/exp/daily_gap_signal_generator.py

      # 5. 上傳產出的 CSV 檔案作為 Artifact
      # 下載路徑更新為 V6.1 的輸出目錄
      - name: Upload Results
        uses: actions/upload-artifact@v4
        with:
          name: gap-signal-report
          path: V6.1/exp/output/*.csv
          retention-days: 5
