yfinance 是一個非常受歡迎的 Python 套件，用於從 Yahoo Finance 下載金融數據。然而，由於它是非官方的 API 封裝器（Wrapper），且 Yahoo Finance 對免費用戶設有數據存取限制，因此在使用 **.history()** 方法抓取歷史股價時，會遇到以下幾個主要的限制：

### ---

**1\. 時間頻率與最大回溯期限制 (Interval vs. Period)**

這是使用者最常遇到的限制。Yahoo Finance 對於「越精細」的數據（如 1 分鐘 K 線），保存的時間越短。

| 數據頻率 (Interval) | 最大可抓取歷史範圍 (Max History) | 備註 |
| :---- | :---- | :---- |
| **1m** (1分鐘) | **7 天** (或是過去 30 天內的 7 天) | 限制最嚴格，無法抓取幾個月前的 1 分鐘數據。 |
| **2m, 5m, 15m, 30m** | **60 天** | 適合短期波段分析，無法做長週期回測。 |
| **60m, 90m** (1小時) | **730 天** (約 2 年) | 適合中期趨勢分析。 |
| **1d** (日線) | **無限制 (Max)** | 可抓取自上市以來的完整數據。 |
| **1wk, 1mo** (週/月) | **無限制 (Max)** | 適合長期投資分析。 |

**注意：** 如果你設定的 start（開始日期）早於上述限制，yfinance 通常會報錯或自動將開始日期調整為允許的最早日期。

![Image of stock market candlestick chart][image1]

Shutterstock

### **2\. 請求頻率限制 (Rate Limiting)**

由於 yfinance 是透過爬蟲或非公開 API 接口抓取數據，Yahoo Finance 會針對 IP 進行流量管制。

* **限制機制：** 如果你在短時間內發送過多請求（例如一秒鐘內查詢 100 檔股票），你的 IP 可能會被暫時封鎖（由數小時至數天不等）。  
* **常見錯誤代碼：** HTTP 429 Too Many Requests 或 404 Not Found（有時被封鎖會誤報為找不到頁面）。  
* **解決方案：**  
  * **使用 pdr.get\_data\_yahoo 的多線程功能時要小心。**  
  * **加入延遲：** 在迴圈中抓取多檔股票時，建議使用 time.sleep(1) 來間隔請求。  
  * **使用代理 (Proxy)：** yfinance 支援透過 proxy 參數更換 IP。

### **3\. 數據準確性與調整 (Adjusted Data)**

* **除權息調整：** yfinance 預設會提供 **調整後收盤價 (Adj Close)**，這考慮了股息和拆股。這對於回測很重要，但如果你需要「當時的實際成交價」，需要特別注意欄位的選擇。  
* **延遲數據：** 雖然大部分美股數據接近即時，但對於某些非美國市場（如台股 .TW），數據可能會有 15-20 分鐘的延遲，或者在收盤後一段時間才更新當日的 High/Low 準確數值。

### **4\. 下市股票與代碼變更**

* **下市公司：** 對於已經下市（Delisted）的公司，Yahoo Finance 常常會直接移除數據，或者數據極度不完整。  
* **代碼變更：** 如果公司更改了股票代碼（Ticker），舊代碼的數據可能無法透過自動導向找到，需要手動搜尋新代碼。

### ---

**如何在程式碼中處理這些限制？**

在使用 .history() 時，必須確保參數符合上述的時間限制規則。

Python

import yfinance as yf

\# 範例：抓取台積電 (2330.TW)  
tsmc \= yf.Ticker("2330.TW")

\# 1\. 正確：抓取日線，過去 10 年  
\# 日線沒有 60 天限制，可以抓很久以前的  
data\_daily \= tsmc.history(period="10y", interval="1d")

\# 2\. 正確：抓取 5 分鐘線，過去 50 天  
\# 5分鐘線限制為 60 天內，所以 50 天是安全的  
data\_5m \= tsmc.history(period="50d", interval="5m")

\# 3\. 錯誤範例：嘗試抓取 1 年前的 5 分鐘線  
\# 這會導致錯誤或只回傳最近 60 天的數據  
\# data\_error \= tsmc.history(period="1y", interval="5m") 

### **總結**

yfinance 是進行**日線等級**回測與分析的神器，完全免費且數據涵蓋廣。但如果你需要進行**高頻交易（High Frequency Trading）或需要多年的分鐘級數據**，yfinance 並不適用，建議尋找付費的數據源（如 Bloomberg, Refinitiv 或專門的 Algo Trading 數據商）。

